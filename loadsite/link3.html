<!DOCTYPE html>
<html>
<head>
    <title>Arcade 4</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
</head>
<body>
    <script>
        // Ensure that the newWindow function runs when the page loads
        $(document).ready(function() {
            newWindow();  // Automatically calls newWindow when the page is loaded
        });

        function newWindow() {
            var win = window.open('');
            
            // Check if the window opened successfully
            if (!win) {
        window.location.href = 'https://blocked.syd-1.linewize.net/blocked?url=school-supplies.khodochoitreem.com&deviceid=PHYS-SMIC-US-0000-2662&rule=R2FtZXMgQmxvY2sgfCBBbGw=&ruleid=6f5477cf-3837-4df4-9e1d-65cf291ffe6b&path=&method=rule_match&cid=NTExODgwMTczNTg0MDk4OTMyMw==';
        return;
            }

            // Insert the head content with CSS links
            win.document.head.innerHTML = `
                <meta charset="UTF-8">
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <!-- Google Fonts -->
                <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans&display=swap" rel="stylesheet">
                <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/style.css">
            `;

            // Insert body content with navigation and container
            win.document.body.innerHTML = `
<ul class="navbar">
  <!-- Home -->
  <li>
    <a aria-label="Home"
       onclick="changePageContent('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/home.html', () => {
         appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/home.js', () => {
           if (typeof displayRandomQuote === 'function') {
             displayRandomQuote();
           }
         });
         appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/customization.js');
       });">
      Home
    </a>
  </li>

  <!-- Games -->
  <li>
    <a aria-label="Games"
       onclick="changePageContent('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/games/games.html', () => {
         appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/games/games.js', () => {
           if (typeof fetchGames === 'function') {
             fetchGames('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/games/games.json');
           }
         });
         appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/customization.js');
       });">
      Games
    </a>
  </li>

  <!-- Apps -->
  <li>
    <a aria-label="Apps"
       onclick="changePageContent('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/games/apps.html', () => {
         appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/games/games.js', () => {
           if (typeof fetchGames === 'function') {
             fetchGames('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/games/apps.json');
           }
         });
         appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@f4140cf/navigation/customization.js');
       });">
      Apps
    </a>
  </li>

  <!-- Settings -->
  <li>
    <a aria-label="Settings"
       onclick="changePageContent('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/settings.html'); appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/customization.js');">
      Settings
    </a>
  </li>
  <li>
    <a aria-label="Fullscreen" onclick="triggerFullscreen()">Fullscreen</a>
  </li>
</ul>

<!-- Main Content Container -->
<div id="content-container" class="content-container"></div>

<!-- Game Iframe -->
<iframe id="Game" frameborder="0" allow="fullscreen"></iframe>
<!-- Pixelated Loading Spinner -->
<div id="spinner">
  <div class="spinner-icon"></div>
</div>
            `;

            // Add necessary JavaScript for dynamic content loading
            var script = document.createElement('script');
            script.textContent = `
                // Change the iframe content when a link is clicked
                function changeIframeContent(page) {
                    document.getElementById('Game').src = page;
                    updateActiveLink(page);
                    const contentContainer = document.getElementById('content-container');
                    contentContainer.style.display = 'none'; // Hide content-container
                }

                // Load the Blob content and update the iframe
                function loadBlobContent(url) {
                    loadPageContent(url, function(content) {
                        var blob = new Blob([content], {type: 'text/html'});
                        var iframe = document.getElementById('Game');
                        iframe.src = URL.createObjectURL(blob);
                        updateActiveLink(url);
                        const contentContainer = document.getElementById('content-container');
                        contentContainer.style.display = 'none'; // Hide content-container
                        document.getElementById("Game").style.display = "block"; // Show the iframe
                    });
                }

function loadPageContent(url, callback) {
    const xhttp = new XMLHttpRequest();

    // Show spinner
    document.getElementById('spinner').style.display = 'flex';

    const urlWithNoCache = url + (url.includes('?') ? '&' : '?') + 'nocache=' + new Date().getTime();
    
    xhttp.onreadystatechange = function () {
        if (this.readyState === 4) {
            // Hide spinner after request completes
            document.getElementById('spinner').style.display = 'none';

            if (this.status === 200) {
                callback(this.responseText);
            } else {
                console.error('Failed to load:', url);
            }
        }
    };

    xhttp.open("GET", urlWithNoCache, true);
    xhttp.send();
}



// Function to trigger fullscreen mode for the iframe or content-container
function triggerFullscreen() {
    const contentContainer = document.querySelector('.content-container');
    const iframe = document.getElementById('Game');
    
    // Check if the content container is visible
    const isContentVisible = contentContainer && contentContainer.offsetWidth > 0 && contentContainer.offsetHeight > 0;

    // If content-container is visible, make it fullscreen
    if (isContentVisible) {
        if (contentContainer.requestFullscreen) {
            contentContainer.requestFullscreen();
        } else if (contentContainer.mozRequestFullScreen) { // Firefox
            contentContainer.mozRequestFullScreen();
        } else if (contentContainer.webkitRequestFullscreen) { // Chrome, Safari, Opera
            contentContainer.webkitRequestFullscreen();
        } else if (contentContainer.msRequestFullscreen) { // IE/Edge
            contentContainer.msRequestFullscreen();
        }
    }
    // If content-container is hidden, make the iframe fullscreen
    else if (iframe) {
        if (iframe.requestFullscreen) {
            iframe.requestFullscreen();
        } else if (iframe.mozRequestFullScreen) { // Firefox
            iframe.mozRequestFullScreen();
        } else if (iframe.webkitRequestFullscreen) { // Chrome, Safari, Opera
            iframe.webkitRequestFullscreen();
        } else if (iframe.msRequestFullscreen) { // IE/Edge
            iframe.msRequestFullscreen();
        }
    }
}


                // Function to change page content and update the active link
function changePageContent(url, callback = null) {
    loadPageContent(url, function(content) {
        const container = document.getElementById('content-container');
        container.innerHTML = content;
        const iframe = document.getElementById("Game");
        iframe.src = "about:blank";
        if (callback) callback();  // Run any extra logic after content is loaded
    });
    updateActiveLink(url);
    const iframe = document.getElementById("Game");
    iframe.style.display = "none"; // Hide the iframe
    const contentContainer = document.getElementById('content-container');
    contentContainer.style.display = 'block'; // Show content-container
}


                // Function to append external JavaScript files
function appendScript(url, callback = null) {
  const script = document.createElement('script');
  script.src = url;
  script.type = 'text/javascript';
  script.onload = () => {
    if (callback) callback();
  };
  script.onerror = () => {
  };
  document.body.appendChild(script);
}

function loadGamesmenu() {
    changePageContent('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@48a3831/navigation/games/games.html', () => {
        appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@48a3831/navigation/games/games.js', () => {
            if (typeof fetchGames === 'function') {
                fetchGames(); 
            }
        });
        appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@1e4c3f0/navigation/customization.js');
    });
}

                // Update active link based on URL
                function updateActiveLink(url) {
                    document.querySelectorAll('ul li a').forEach(link => {
                        link.classList.remove('active');
                    });

                    const activeLink = document.querySelector(\`a[onclick*="\${url}"]\`);
                    if (activeLink) {
                        activeLink.classList.add('active');
                        document.getElementById("Game").style.display = "block"; // Show the iframe
                    }

                }
changePageContent('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/home.html', () => {
         appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/home.js', () => {
           if (typeof displayRandomQuote === 'function') {
             displayRandomQuote();
           }
         });
         appendScript('https://cdn.jsdelivr.net/gh/FutureElliotto/Arcade-4@56cac32/navigation/customization.js');
       });
if (localStorage.getItem("faviconSrc") == null) {
    localStorage.setItem('faviconSrc', 'https://cdn.jsdelivr.net/gh/FutureElliotto/arcade-4-images/favicon/logo.png');
}
if (localStorage.getItem("pageTitle") == null) {
    localStorage.setItem('pageTitle', 'Arcade 4');
}
if (localStorage.getItem("userFont") == null) {
    localStorage.setItem('userFont', 'Pixelify Sans');
}

            `;
            win.document.head.appendChild(script);
            window.location.href = 'https://classroom.google.com/';

        }
    </script>
</body>
</html>
